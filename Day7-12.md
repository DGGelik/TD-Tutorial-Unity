### День 7 — Wave Spawner (базовая структура)

**Цель дня:** Сделать систему, которая будет автоматически выпускать волны врагов.

1. В Hierarchy → правой кнопкой → Create Empty → назовите **GameManager**

2. Assets → Create → C# Script → назовите `WaveSpawner`

3. Откройте скрипт и вставьте следующий код:

```csharp
using UnityEngine;
using System.Collections;

public class WaveSpawner : MonoBehaviour
{
    [Header("Настройки спавна")]
    public Transform spawnPoint;                // WP0
    public GameObject enemyPrefab;              // EnemySlime.prefab
    public float timeBetweenEnemies = 0.8f;     // пауза между врагами в волне
    public float timeBetweenWaves = 8f;         // пауза между волнами

    [Header("Тестовые волны")]
    public int enemiesInWave = 5;
    public int totalWavesToSpawn = 3;           // пока только 3 волны для теста

    private int currentWave = 0;
    private float countdown = 2f;               // время до первой волны

    private void Update()
    {
        if (countdown <= 0f)
        {
            if (currentWave < totalWavesToSpawn)
            {
                StartCoroutine(SpawnWave());
                currentWave++;
                countdown = timeBetweenWaves;
            }
        }
        else
        {
            countdown -= Time.deltaTime;
        }
    }

    IEnumerator SpawnWave()
    {
        for (int i = 0; i < enemiesInWave; i++)
        {
            SpawnEnemy();
            yield return new WaitForSeconds(timeBetweenEnemies);
        }
    }

    void SpawnEnemy()
    {
        Instantiate(enemyPrefab, spawnPoint.position, Quaternion.identity);
    }
}
```

4. Прикрепите скрипт к объекту **GameManager**

5. В инспекторе:
   - Spawn Point → перетащите WP0 из Waypoints
   - Enemy Prefab → перетащите EnemySlime.prefab
   - Enemies In Wave → 5
   - Total Waves To Spawn → 3

6. Создайте Canvas (если ещё нет):
   - Hierarchy → UI → Canvas
   - Переименуйте в **UICanvas**
   - Добавьте дочерний объект → UI → Text - TextMeshPro (если TMP не установлен — установите через Package Manager → TextMeshPro)

7. TextMeshPro - UGUI → текст «Wave Incoming: --»

**Контрольная проверка дня 7**  
Нажмите Play → через 2 секунды должны начать появляться 5 слизней с интервалом 0.8 сек, потом пауза 8 секунд, потом снова волна — всего 3 раза.

---

### День 8 — Улучшение WaveSpawner + countdown UI

**Цель дня:** Сделать видимый обратный отсчёт до следующей волны.

1. Откройте WaveSpawner.cs и добавьте следующие поля и логику:

```csharp
// добавьте в начало класса
[Header("UI")]
public TMPro.TextMeshProUGUI countdownText;

// замените Update на:
private void Update()
{
    if (countdown <= 0f)
    {
        if (currentWave < totalWavesToSpawn)
        {
            StartCoroutine(SpawnWave());
            currentWave++;
            countdown = timeBetweenWaves;
        }
    }
    else
    {
        countdown -= Time.deltaTime;
        if (countdownText != null)
        {
            countdownText.text = $"Следующая волна через: {Mathf.Ceil(countdown)}";
        }
    }
}
```

2. В Hierarchy → UICanvas → создайте новый TextMeshPro - Text (назовите CountdownText)
   - Rect Transform → Anchor → Top Center
   - Pos Y ≈ -80
   - Font Size → 48
   - Alignment → Center

3. В инспекторе WaveSpawner → перетащите CountdownText в поле Countdown Text

**Контрольная проверка дня 8**  
Теперь перед каждой волной видно «Следующая волна через: 8» → 7 → … → 1 → волна начинается.

---

### День 9 — Archer Tower (префаб + визуал)

**Цель дня:** Создать префаб башни-лучника.

1. Hierarchy → Create Empty → назовите **ArcherTower**

2. Добавьте Sprite Renderer → перетащите спрайт башни из Kenney (желательно с основанием)

3. Добавьте дочерний пустой объект → назовите **Turret** (это будет вращающаяся часть)
   - Перетащите в него спрайт ствола/головы башни (если есть отдельный)

4. Добавьте **Circle Collider 2D** на ArcherTower
   - Is Trigger = true
   - Radius = 3.5 (это зона обнаружения)

5. Перетащите ArcherTower в **Assets/Prefabs/Towers/ArcherTower.prefab**

6. Удалите объект из сцены

**Результат дня 9**  
Готовый префаб визуальной башни.

---

### День 10 — TowerController (поиск цели + поворот)

Создайте скрипт **TowerController.cs**

```csharp
using UnityEngine;

public class TowerController : MonoBehaviour
{
    [Header("Настройки")]
    public float range = 3.5f;
    public float fireRate = 1.2f;       // выстрелы в секунду
    public float damage = 25f;

    [Header("Компоненты")]
    public Transform turret;            // дочерний объект Turret
    public Transform firePoint;         // откуда вылетает снаряд (позже)

    private Transform target;
    private float fireCountdown = 0f;

    private void Update()
    {
        UpdateTarget();
        if (target != null)
        {
            LockOnTarget();
            if (fireCountdown <= 0f)
            {
                Shoot();
                fireCountdown = 1f / fireRate;
            }
        }

        fireCountdown -= Time.deltaTime;
    }

    void UpdateTarget()
    {
        GameObject[] enemies = GameObject.FindGameObjectsWithTag("Enemy");
        float shortestDistance = Mathf.Infinity;
        Transform nearestEnemy = null;

        foreach (GameObject enemy in enemies)
        {
            float distanceToEnemy = Vector2.Distance(transform.position, enemy.transform.position);
            if (distanceToEnemy < shortestDistance && distanceToEnemy <= range)
            {
                shortestDistance = distanceToEnemy;
                nearestEnemy = enemy.transform;
            }
        }

        target = nearestEnemy;
    }

    void LockOnTarget()
    {
        if (turret == null) return;

        Vector3 dir = target.position - turret.position;
        float angle = Mathf.Atan2(dir.y, dir.x) * Mathf.Rad2Deg;
        turret.rotation = Quaternion.Euler(0f, 0f, angle - 90f); // -90 для спрайтов, смотрящих вверх
    }

    void Shoot()
    {
        Debug.Log("Выстрел!");
        // Пока просто лог — снаряд добавим завтра
    }
}
```

1. Прикрепите скрипт к префабу ArcherTower
2. Создайте пустой дочерний объект **FirePoint** внутри Turret (позиция на конце ствола)
3. Перетащите Turret и FirePoint в соответствующие поля инспектора

**Контрольная проверка дня 10**  
Поставьте башню в сцену → запустите → подвиньте врага в радиус → башня должна поворачиваться к нему.

---

### День 11 — Снаряд (Bullet)

1. Hierarchy → Create Empty → **Bullet**

2. Добавьте Sprite Renderer → маленький круг или стрелка

3. Добавьте **Rigidbody 2D**
   - Body Type = Kinematic
   - Gravity Scale = 0

4. Добавьте **Circle Collider 2D** → Is Trigger = true → Radius ≈ 0.15

5. Создайте скрипт **Bullet.cs**

```csharp
using UnityEngine;

public class Bullet : MonoBehaviour
{
    public float speed = 10f;
    public float damage = 25f;
    public Transform target;

    private void Update()
    {
        if (target == null)
        {
            Destroy(gameObject);
            return;
        }

        Vector2 direction = (target.position - transform.position).normalized;
        transform.position += (Vector3)direction * speed * Time.deltaTime;

        // Поворот спрайта по направлению (если нужно)
        float angle = Mathf.Atan2(direction.y, direction.x) * Mathf.Rad2Deg;
        transform.rotation = Quaternion.Euler(0, 0, angle - 90f);
    }

    private void OnTriggerEnter2D(Collider2D other)
    {
        if (other.CompareTag("Enemy"))
        {
            EnemyHealth enemy = other.GetComponent<EnemyHealth>();
            if (enemy != null)
            {
                enemy.TakeDamage(damage);
            }
            Destroy(gameObject);
        }
    }
}
```

6. Прикрепите скрипт к префабу Bullet → сохраните в Prefabs/Projectiles/Bullet.prefab

7. В TowerController добавьте поле и измените Shoot():

```csharp
public GameObject bulletPrefab;

void Shoot()
{
    GameObject bulletGO = Instantiate(bulletPrefab, firePoint.position, firePoint.rotation);
    Bullet bullet = bulletGO.GetComponent<Bullet>();
    if (bullet != null)
    {
        bullet.target = target;
        bullet.damage = damage;
    }
}
```

8. В инспекторе ArcherTower → перетащите Bullet.prefab в поле Bullet Prefab

**Контрольная проверка дня 11**  
Башня теперь должна выпускать снаряды, которые летят за врагом и наносят урон (HP-бар уменьшается).

---

### День 12 — Простое размещение башен

Создайте скрипт **BuildManager.cs**

```csharp
using UnityEngine;

public class BuildManager : MonoBehaviour
{
    public static BuildManager main;

    public GameObject towerPrefab;
    public int gold = 200;

    private void Awake()
    {
        main = this;
    }

    private void Update()
    {
        if (Input.GetMouseButtonDown(0))
        {
            Vector2 mousePos = Camera.main.ScreenToWorldPoint(Input.mousePosition);
            PlaceTower(mousePos);
        }
    }

    void PlaceTower(Vector2 position)
    {
        // Пока простая проверка — позже добавим Tilemap-слой
        if (gold >= 80)
        {
            Instantiate(towerPrefab, position, Quaternion.identity);
            gold -= 80;
            Debug.Log("Башня построена. Остаток золота: " + gold);
        }
    }
}
```

1. Прикрепите BuildManager к GameManager
2. Перетащите ArcherTower.prefab в поле Tower Prefab

**Контрольная проверка дня 12**  
Нажмите Play → кликайте левой кнопкой мыши по карте → должны появляться башни (пока без проверки на траву/дорогу).

---

**Итог Месяца 1**  
К концу 12-го дня у вас должен быть рабочий мини-прототип:
- враги идут по пути волнами
- башни можно ставить кликом
- башни поворачиваются, стреляют, наносят урон
- враги теряют здоровье и умирают
