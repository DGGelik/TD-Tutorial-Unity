Предполагаем, что **Месяц 1 завершён**:
- враги ходят по waypoints
- волны спавнятся
- одна башня (ArcherTower) поворачивается и стреляет снарядами
- размещение пока простое (клик мышью без проверки)

### День 13 — Создание остальных башен (префабы + базовая дифференциация)

**Цель дня:** Подготовить 4 префаба башен с разными визуалами и стартовыми статами.

1. В Project окне → Assets/Prefabs/Towers → дублируйте **ArcherTower.prefab** (правой кнопкой → Duplicate) → переименуйте в **FireTower.prefab**

2. Откройте **FireTower.prefab** в сцене (перетащите в Hierarchy):
   - SpriteRenderer → замените спрайт на огненную башню из Kenney (или любой другой)
   - Turret → замените спрайт головы/ствола на огненный вариант (если есть)
   - CircleCollider2D → Radius оставьте 3.5 (или сделайте 3.0 для меньшей дальности)

3. Аналогично создайте:
   - **FrostTower.prefab** — ледяная башня, Radius 3.2
   - **ChainTower.prefab** — электрическая/молниевая башня, Radius 3.8

4. Сохраните все 4 префаба.

**Почему так?**  
Разные визуалы сразу дают ощущение разнообразия. Позже статы вынесем в ScriptableObject, но пока оставляем в компоненте TowerController для скорости.

**Контрольная проверка дня 13**  
Перетащите все 4 башни в сцену → Play → они должны поворачиваться к врагам (пока стреляют одинаково).

---

### День 14 — ScriptableObject для данных башен (TowerData)

**Цель дня:** Вынести статы башен в ScriptableObject — это ключ к масштабируемости.

1. Assets → Create → C# Script → назовите `TowerData`

```csharp
using UnityEngine;

[CreateAssetMenu(fileName = "TowerData", menuName = "Tower Defense/Tower Data")]
public class TowerData : ScriptableObject
{
    public string towerName = "Tower";

    [Header("Базовые характеристики")]
    public float baseDamage = 20f;
    public float baseFireRate = 1f;         // выстрелы в секунду
    public float baseRange = 3.5f;
    public int baseCost = 80;

    [Header("Улучшения — 3 уровня")]
    public int[] upgradeCosts = { 120, 180, 0 }; // 0 = нет дальше улучшения
    public float[] upgradeDamageMultipliers = { 1.0f, 1.6f, 2.4f };
    public float[] upgradeFireRateMultipliers = { 1.0f, 1.4f, 1.8f };
    public float[] upgradeRangeMultipliers = { 1.0f, 1.3f, 1.6f };

    [Header("Визуал")]
    public Sprite icon;                     // для UI магазина
    public GameObject turretPrefab;         // префаб башни
}
```

2. Создайте 4 ассета:
   - Assets/ScriptableObjects/Towers → правой кнопкой → Tower Defense → Tower Data
   - Назовите: ArcherTowerData, FireTowerData, FrostTowerData, ChainTowerData

3. Заполните примерные значения:
   - Archer: damage 20, fireRate 1.5, range 3.5, cost 80
   - Fire: damage 45, fireRate 0.7, range 3.0, cost 160
   - Frost: damage 25, fireRate 1.0, range 3.2, cost 120
   - Chain: damage 30, fireRate 0.9, range 3.8, cost 180

**Контрольная проверка дня 14**  
Ассеты созданы, статы заполнены — они видны в инспекторе.

---

### День 15 — Система улучшений башен

**Цель дня:** Добавить уровни улучшения (пока только логика, UI позже).

1. Откройте **TowerController.cs** и полностью перепишите его под новую систему:

```csharp
using UnityEngine;

public class TowerController : MonoBehaviour
{
    [Header("Данные")]
    public TowerData data;

    [Header("Текущее состояние")]
    public int currentLevel = 1;                    // начинается с 1 уровня
    private float currentDamage;
    private float currentFireRate;
    private float currentRange;

    [Header("Компоненты")]
    public Transform turret;
    public Transform firePoint;
    public GameObject bulletPrefab;

    private Transform target;
    private float fireCountdown = 0f;

    private void Start()
    {
        ApplyLevelStats();
    }

    private void ApplyLevelStats()
    {
        currentDamage = data.baseDamage * data.upgradeDamageMultipliers[currentLevel - 1];
        currentFireRate = data.baseFireRate * data.upgradeFireRateMultipliers[currentLevel - 1];
        currentRange = data.baseRange * data.upgradeRangeMultipliers[currentLevel - 1];

        // Можно здесь менять спрайт или масштаб при улучшении
    }

    private void Update()
    {
        UpdateTarget();

        if (target != null)
        {
            LockOnTarget();

            fireCountdown -= Time.deltaTime;
            if (fireCountdown <= 0f)
            {
                Shoot();
                fireCountdown = 1f / currentFireRate;
            }
        }
    }

    void UpdateTarget()
    {
        Collider2D[] hits = Physics2D.OverlapCircleAll(transform.position, currentRange);
        Transform nearest = null;
        float minDist = float.MaxValue;

        foreach (var hit in hits)
        {
            if (hit.CompareTag("Enemy"))
            {
                float dist = Vector2.Distance(transform.position, hit.transform.position);
                if (dist < minDist)
                {
                    minDist = dist;
                    nearest = hit.transform;
                }
            }
        }

        target = nearest;
    }

    void LockOnTarget()
    {
        if (turret == null) return;
        Vector3 dir = target.position - turret.position;
        float angle = Mathf.Atan2(dir.y, dir.x) * Mathf.Rad2Deg;
        turret.rotation = Quaternion.Euler(0f, 0f, angle - 90f);
    }

    void Shoot()
    {
        if (bulletPrefab == null) return;

        GameObject bulletGO = Instantiate(bulletPrefab, firePoint.position, firePoint.rotation);
        Bullet bullet = bulletGO.GetComponent<Bullet>();
        if (bullet != null)
        {
            bullet.target = target;
            bullet.damage = currentDamage;
        }
    }

    // Метод для улучшения (вызовем позже из UI)
    public bool Upgrade()
    {
        if (currentLevel >= 3) return false;

        int nextLevel = currentLevel + 1;
        int cost = data.upgradeCosts[nextLevel - 2]; // индекс массива на 1 меньше

        if (BuildManager.main.SpendGold(cost))
        {
            currentLevel = nextLevel;
            ApplyLevelStats();
            return true;
        }
        return false;
    }
}
```

2. На каждом префабе башни:
   - Перетащите соответствующий TowerData в поле Data
   - Убедитесь, что bulletPrefab назначен

**Контрольная проверка дня 15**  
Поставьте башню → она использует статы из ScriptableObject. Пока улучшение не работает — только логика готова.

---

### День 16 — Магазин башен + выбор

**Цель дня:** UI-магазин с 4 кнопками и выбором башни.

1. В UICanvas → создайте Panel → назовите **ShopPanel**
   - Anchor → Bottom Stretch
   - Height ≈ 120

2. В ShopPanel создайте 4 кнопки (UI → Button):
   - ArcherButton, FireButton, FrostButton, ChainButton
   - На каждой кнопке добавьте Image (иконка башни) + Text (цена)

3. Создайте скрипт **TowerShop.cs** на ShopPanel:

```csharp
using UnityEngine;
using UnityEngine.UI;

public class TowerShop : MonoBehaviour
{
    public Button[] towerButtons;           // 4 кнопки
    public TowerData[] towerDatas;          // соответствующие данные

    private void Start()
    {
        for (int i = 0; i < towerButtons.Length; i++)
        {
            int index = i; // захват переменной
            towerButtons[i].onClick.AddListener(() => SelectTower(index));
        }
    }

    void SelectTower(int index)
    {
        BuildManager.main.selectedTowerData = towerDatas[index];
        Debug.Log("Выбрана башня: " + towerDatas[index].towerName);
    }
}
```

4. В BuildManager.cs добавьте:

```csharp
public TowerData selectedTowerData;
```

**Контрольная проверка дня 16**  
Клик по кнопке → в консоли появляется сообщение о выборе башни.

---

### День 17 — Размещение с preview (ghost)

**Цель дня:** Ghost-превью + правильное размещение.

1. В BuildManager добавьте:

```csharp
private GameObject ghostTower;
private SpriteRenderer ghostRenderer;

private void Update()
{
    if (selectedTowerData != null)
    {
        UpdateGhost();
        
        if (Input.GetMouseButtonDown(0))
        {
            TryPlaceTower();
        }
    }
    else if (ghostTower != null)
    {
        Destroy(ghostTower);
        ghostTower = null;
    }
}

void UpdateGhost()
{
    Vector2 mousePos = Camera.main.ScreenToWorldPoint(Input.mousePosition);

    if (ghostTower == null)
    {
        ghostTower = Instantiate(selectedTowerData.turretPrefab, mousePos, Quaternion.identity);
        ghostRenderer = ghostTower.GetComponent<SpriteRenderer>();
        ghostRenderer.color = new Color(1,1,1,0.5f); // полупрозрачный
        // Отключить коллайдеры и скрипты на ghost
        Collider2D col = ghostTower.GetComponent<Collider2D>();
        if (col) col.enabled = false;
        TowerController tc = ghostTower.GetComponent<TowerController>();
        if (tc) tc.enabled = false;
    }
    else
    {
        ghostTower.transform.position = mousePos;
    }
}

void TryPlaceTower()
{
    Vector2 pos = Camera.main.ScreenToWorldPoint(Input.mousePosition);

    // Пока простая проверка — позже добавим Tilemap-слой
    if (SpendGold(selectedTowerData.baseCost))
    {
        Instantiate(selectedTowerData.turretPrefab, pos, Quaternion.identity);
        selectedTowerData = null; // сброс выбора
        if (ghostTower) Destroy(ghostTower);
    }
}
```

2. В TowerData добавьте поле `public GameObject turretPrefab;`

3. Заполните turretPrefab в каждом TowerData ассете.

**Контрольная проверка дня 17**  
Выберите башню → появляется полупрозрачный ghost → клик → башня ставится за золото.

---

### День 18 — Проверка на размещение (слой Buildable)

**Цель дня:** Запретить ставить на дороге.

1. В Tilemap → GroundTilemap → Layer → создайте новый слой **Buildable** и назначьте его

2. RoadTilemap → Layer → **Road** (или Default)

3. В BuildManager → TryPlaceTower замените проверку:

```csharp
void TryPlaceTower()
{
    Vector2 mousePos = Camera.main.ScreenToWorldPoint(Input.mousePosition);
    RaycastHit2D hit = Physics2D.Raycast(mousePos, Vector2.zero);

    if (hit.collider != null && hit.collider.gameObject.layer == LayerMask.NameToLayer("Buildable"))
    {
        if (SpendGold(selectedTowerData.baseCost))
        {
            Instantiate(selectedTowerData.turretPrefab, hit.point, Quaternion.identity);
            selectedTowerData = null;
            if (ghostTower) Destroy(ghostTower);
        }
    }
    else
    {
        Debug.Log("Нельзя строить здесь!");
    }
}
```

4. В UpdateGhost добавьте изменение цвета:

```csharp
if (hit.collider != null && hit.collider.gameObject.layer == LayerMask.NameToLayer("Buildable"))
    ghostRenderer.color = new Color(0.2f, 1f, 0.2f, 0.6f); // зелёный
else
    ghostRenderer.color = new Color(1f, 0.2f, 0.2f, 0.6f); // красный
```

**Контрольная проверка дня 18**  
Нельзя поставить башню на дорогу → ghost красный; на траве — зелёный и ставится.