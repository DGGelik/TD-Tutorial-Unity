### День 31 — Базовые звуковые эффекты (стрельба, попадание, смерть)

**Цель дня:** Добавить звуки для основных действий.

1. Скачайте бесплатные звуки (рекомендую Kenney.nl/sounds или freesound.org с лицензией CC0):
   - shoot_arrow.wav / shoot_fire.wav / shoot_frost.wav / shoot_chain.wav
   - hit.wav (общий звук попадания)
   - enemy_death.wav
   - tower_place.wav
   - tower_upgrade.wav
   - tower_sell.wav

2. Создайте папку **Assets/Audio/SFX** и перетащите туда все файлы.

3. Создайте пустой GameObject → назовите **AudioManager** → добавьте компонент **AudioSource** (несколько штук или один с AudioMixer позже).

4. Создайте скрипт **AudioManager.cs** (прикрепите к AudioManager):

```csharp
using UnityEngine;

public class AudioManager : MonoBehaviour
{
    public static AudioManager Instance { get; private set; }

    [Header("Звуки")]
    public AudioClip shootArrow, shootFire, shootFrost, shootChain;
    public AudioClip hitSound, deathSound;
    public AudioClip placeTower, upgradeTower, sellTower;

    private AudioSource sfxSource;

    private void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else
        {
            Destroy(gameObject);
            return;
        }

        sfxSource = gameObject.AddComponent<AudioSource>();
        sfxSource.playOnAwake = false;
    }

    public void PlaySFX(AudioClip clip, float volume = 0.7f)
    {
        if (clip == null) return;
        sfxSource.PlayOneShot(clip, volume);
    }
}
```

5. В **TowerController.Shoot()** добавьте:

```csharp
if (data.towerName == "Archer")      AudioManager.Instance.PlaySFX(AudioManager.Instance.shootArrow);
else if (data.towerName == "Fire")   AudioManager.Instance.PlaySFX(AudioManager.Instance.shootFire);
// и т.д. для остальных
```

6. В **EnemyHealth.TakeDamage()** и **Die()**:

```csharp
AudioManager.Instance.PlaySFX(AudioManager.Instance.hitSound, 0.6f);
// и в Die():
AudioManager.Instance.PlaySFX(AudioManager.Instance.deathSound, 0.8f);
```

7. В **BuildManager.TryPlaceTower()** и **TowerController.Upgrade()**, **Sell()** — аналогично вызовы placeTower / upgradeTower / sellTower.

**Контрольная проверка дня 31**  
Постройте башню → слышен звук установки.  
Выстрел → звук стрельбы.  
Попадание и смерть врага → соответствующие звуки.

---

### День 32 — Фоновая музыка + переход между спокойной и напряжённой

**Цель дня:** Добавить фоновую музыку, которая меняется по ходу игры.

1. Скачайте 2 трека (бесплатные):
   - calm_loop.mp3 (спокойная фэнтези-музыка)
   - intense_battle.mp3 (напряжённая, с барабанами)

2. Создайте в AudioManager два AudioSource:
   - один для музыки (Loop = true, volume = 0.4)
   - назовите их musicCalmSource и musicIntenseSource

3. Добавьте в AudioManager.cs:

```csharp
[Header("Музыка")]
public AudioClip calmMusic, intenseMusic;
private AudioSource calmSource, intenseSource;

private void Start()
{
    calmSource = gameObject.AddComponent<AudioSource>();
    calmSource.clip = calmMusic;
    calmSource.loop = true;
    calmSource.volume = 0.35f;

    intenseSource = gameObject.AddComponent<AudioSource>();
    intenseSource.clip = intenseMusic;
    intenseSource.loop = true;
    intenseSource.volume = 0f; // изначально выключена

    calmSource.Play();
}
```

4. Создайте метод переключения:

```csharp
public void SwitchToIntense(bool active)
{
    if (active)
    {
        calmSource.volume = Mathf.Lerp(calmSource.volume, 0f, Time.deltaTime * 2);
        intenseSource.volume = Mathf.Lerp(intenseSource.volume, 0.45f, Time.deltaTime * 2);
        if (!intenseSource.isPlaying) intenseSource.Play();
    }
    else
    {
        intenseSource.volume = Mathf.Lerp(intenseSource.volume, 0f, Time.deltaTime * 2);
        calmSource.volume = Mathf.Lerp(calmSource.volume, 0.35f, Time.deltaTime * 2);
    }
}
```

5. В **WaveSpawner.Update()**:

```csharp
if (currentWave >= 7)
{
    AudioManager.Instance.SwitchToIntense(true);
}
else
{
    AudioManager.Instance.SwitchToIntense(false);
}
```

**Контрольная проверка дня 32**  
Игра начинается со спокойной музыки.  
Начиная с 7-й волны музыка плавно переходит на интенсивную.

---

### День 33 — Баланс волн через ScriptableObject (WaveConfig)

**Цель дня:** Сделать волны настраиваемыми и разнообразными.

1. Создайте ScriptableObject **WaveConfig.cs**

```csharp
using UnityEngine;

[CreateAssetMenu(fileName = "WaveConfig", menuName = "Tower Defense/Wave Config")]
public class WaveConfig : ScriptableObject
{
    [System.Serializable]
    public class WaveData
    {
        public GameObject enemyPrefab;
        public int count;
        public float spawnInterval = 0.8f;
        public float delayBeforeWave = 8f;
    }

    public WaveData[] waves; // массив из 12 волн
}
```

2. Создайте ассет **Level1Waves.asset** и заполните примерно так:

   Волна 1: Slime × 8, interval 1.0  
   Волна 4: Slime × 5 + Spider × 4  
   Волна 8: Wraith × 6 + Troll × 2  
   Волна 12: Boss × 1 + Spider × 8 + Slime × 5

3. В **WaveSpawner.cs** замените текущую логику на:

```csharp
public WaveConfig waveConfig;

private int currentWaveIndex = 0;

IEnumerator SpawnWave()
{
    var wave = waveConfig.waves[currentWaveIndex];

    for (int i = 0; i < wave.count; i++)
    {
        Instantiate(wave.enemyPrefab, spawnPoint.position, Quaternion.identity);
        yield return new WaitForSeconds(wave.spawnInterval);
    }

    currentWaveIndex++;
    if (currentWaveIndex < waveConfig.waves.Length)
    {
        countdown = waveConfig.waves[currentWaveIndex].delayBeforeWave;
    }
}
```

**Контрольная проверка дня 33**  
Игра запускается → волны идут по конфигу из ScriptableObject, разные враги появляются в нужном количестве и с нужными интервалами.

---

### День 34 — Статистика игры (убито врагов, построено башен и т.д.)

**Цель дня:** Собрать статистику для экрана победы.

1. В **GameManager** или **BuildManager** добавьте:

```csharp
public int enemiesKilled = 0;
public int towersBuilt = 0;
public int towersUpgraded = 0;
public int totalGoldEarned = 0;
```

2. В **EnemyHealth.Die()**:

```csharp
BuildManager.main.enemiesKilled++;
BuildManager.main.totalGoldEarned += goldReward;
```

3. В **BuildManager.TryPlaceTower()**:

```csharp
towersBuilt++;
```

4. В **TowerController.Upgrade()** (если успешно):

```csharp
BuildManager.main.towersUpgraded++;
```

5. В **VictoryPanel** добавьте TextMeshPro:

   - Enemies Killed: {enemiesKilled}
   - Towers Built: {towersBuilt}
   - Towers Upgraded: {towersUpgraded}
   - Gold Earned: {totalGoldEarned}

**Контрольная проверка дня 34**  
После победы на экране отображается реальная статистика партии.

---

### День 35 — Object Pooling для пуль (оптимизация)

**Цель дня:** Убрать лаги при большом количестве выстрелов.

1. Создайте скрипт **BulletPool.cs** (прикрепите к GameManager или отдельному объекту):

```csharp
using System.Collections.Generic;
using UnityEngine;

public class BulletPool : MonoBehaviour
{
    public static BulletPool Instance;

    [SerializeField] private GameObject bulletPrefab;
    [SerializeField] private int poolSize = 50;

    private List<GameObject> pool = new List<GameObject>();

    private void Awake()
    {
        Instance = this;

        for (int i = 0; i < poolSize; i++)
        {
            GameObject bullet = Instantiate(bulletPrefab);
            bullet.SetActive(false);
            pool.Add(bullet);
        }
    }

    public GameObject GetBullet()
    {
        foreach (var bullet in pool)
        {
            if (!bullet.activeInHierarchy)
            {
                bullet.SetActive(true);
                return bullet;
            }
        }

        // Если все заняты — создаём новый
        GameObject newBullet = Instantiate(bulletPrefab);
        pool.Add(newBullet);
        return newBullet;
    }

    public void ReturnBullet(GameObject bullet)
    {
        bullet.SetActive(false);
        bullet.transform.position = Vector3.one * 9999; // убрать с глаз
    }
}
```

2. В **TowerController.Shoot()** замените Instantiate на:

```csharp
GameObject bulletGO = BulletPool.Instance.GetBullet();
bulletGO.transform.position = firePoint.position;
bulletGO.transform.rotation = firePoint.rotation;
bulletGO.SetActive(true);

// Настроить Bullet
Bullet bullet = bulletGO.GetComponent<Bullet>();
if (bullet != null)
{
    bullet.target = target;
    bullet.damage = currentDamage;
    bullet.sourceTowerData = data;
}
```

3. В **Bullet** добавьте в конец OnTriggerEnter2D или когда цель потеряна:

```csharp
BulletPool.Instance.ReturnBullet(gameObject);
```

**Контрольная проверка дня 35**  
Постройте 10–15 башен → на поздних волнах (много врагов) FPS остаётся стабильным (>55–60), объекты не плодятся бесконечно.

---

### День 36 — Финальный тест и полировка Месяца 3

**Цель дня:** Полное прохождение уровня + фикс багов.

1. Составьте чек-лист (запишите в блокнот или документ):

   - Все 4 типа башен стреляют и улучшаются
   - Летающие враги игнорируются стрелковыми и ледяными башнями
   - Замедление работает
   - Цепная молния бьёт по 3–4 целям
   - Звуки на месте и не перекрывают друг друга
   - Музыка переключается на 7-й волне
   - Волны идут по конфигу (12 разных)
   - Статистика отображается на экране победы
   - Нет лагов при 40+ врагах одновременно
   - Нет ошибок в консоли

2. Пройдите уровень от начала до конца 3–5 раз, фиксируя баги.

3. Исправьте найденные проблемы (чаще всего):
   - target = null после смерти врага → добавить проверку в Update()
   - звук не играет → проверить, что AudioManager существует
   - волны не заканчиваются → проверить currentWaveIndex < waves.Length

**Контрольная проверка дня 36 (и Месяца 3)**  
Вы можете пройти 12 волн без критических багов, игра выглядит и звучит значительно лучше, чем в конце Месяца 2.

---

**Итог Месяца 3**  
К концу месяца у вас полноценная игра с:
- всеми врагами и боссом
- специальными механиками башен (замедление, цепь, иммунитет летающих)
- звуком и музыкой
- настраиваемыми волнами
- статистикой и оптимизацией